define("qtype_gapfill/modal",["exports","core/modal_factory","core/modal_events","core/log","core/templates","qtype_gapfill/gaps"],(function(_exports,_modal_factory,_modal_events,_log,_templates,_gaps){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript code for handling the gap settings modal.
   *
   * @module qtype_gapfill/modal
   * @copyright  2025 Marcus Green
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showGapSettingsModal=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_log=_interopRequireDefault(_log),_templates=_interopRequireDefault(_templates);_exports.showGapSettingsModal=async gapInfo=>{const correctLabel=M.util.get_string("correct","qtype_gapfill"),incorrectLabel=M.util.get_string("incorrect","qtype_gapfill"),delimitcharsElement=document.getElementById("id_delimitchars"),delimitchars=delimitcharsElement?delimitcharsElement.value:"[]",cleanGapText=(0,_gaps.stripdelim)(gapInfo.gapText,delimitchars),titleString=M.util.get_string("additemsettings","qtype_gapfill")+": "+cleanGapText,templateContext={correct:correctLabel,incorrect:incorrectLabel},bodyContent=await _templates.default.render("qtype_gapfill/gapfeedback_modal",templateContext),modal=await _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:titleString,body:bodyContent,large:!0});let correctEditorInstance=null,incorrectEditorInstance=null;modal.show(),(0,_gaps.updateGapClassesFromSettings)(gapInfo),modal.getRoot().on(_modal_events.default.shown,(async()=>{await new Promise((resolve=>setTimeout(resolve,300)));const correctEditor=tinyMCE.get("gapfill-feedback-correct");correctEditor&&correctEditor.remove();const incorrectEditor=tinyMCE.get("gapfill-feedback-incorrect");incorrectEditor&&incorrectEditor.remove();const feedback=(0,_gaps.getItemSettings)(gapInfo);try{await tinyMCE.init({selector:"#gapfill-feedback-correct, #gapfill-feedback-incorrect",menubar:!1,toolbar:"undo redo | formatselect | bold italic | bullist numlist | link unlink",plugins:"lists link",height:150,setup:ed=>{ed.on("init",(()=>{const editorId=ed.id,content="gapfill-feedback-correct"===editorId?feedback&&feedback.correctFeedback||"":feedback&&feedback.incorrectFeedback||"";"gapfill-feedback-correct"===editorId?correctEditorInstance=ed:incorrectEditorInstance=ed,ed.setContent(content)}))}})}catch(error){_log.default.debug("Failed to initialize TinyMCE:",error)}modal.getRoot().on(_modal_events.default.save,(e=>{e.preventDefault();const correctFeedback=correctEditorInstance?correctEditorInstance.getContent():"",incorrectFeedback=incorrectEditorInstance?incorrectEditorInstance.getContent():"",JSONstr=(0,_gaps.updateJson)(gapInfo,correctFeedback,incorrectFeedback),itemSettingsField=document.querySelector("[name='itemsettings']");itemSettingsField&&(itemSettingsField.value=JSONstr),(0,_gaps.updateGapClasses)(gapInfo,correctFeedback,incorrectFeedback),modal.hide()}))})),modal.getRoot().on(_modal_events.default.hidden,(()=>{if(tinyMCE){const correctEditor=tinyMCE.get("gapfill-feedback-correct");correctEditor&&correctEditor.remove();const incorrectEditor=tinyMCE.get("gapfill-feedback-incorrect");incorrectEditor&&incorrectEditor.remove()}}))}}));

//# sourceMappingURL=modal.min.js.map