{"version":3,"file":"tiny_gapfeedback.min.js","sources":["../src/tiny_gapfeedback.js"],"sourcesContent":["/**\n * TinyMCE gap feedback functionality for gapfill question type.\n *\n * @module qtype_gapfill/tiny_gapfeedback\n */\n\n// Import functions from gaps.js using ES6 import\nimport {parseQuestionText, getGap, initializeAllGapClasses} from 'qtype_gapfill/gaps';\nimport {showGapSettingsModal} from 'qtype_gapfill/modal';\n\n\n/**\n * Handle click events on the select area\n * @param {Event} event - The click event\n */\nconst handleSelectAreaClick = (event) => {\n    // Prevent default behavior to avoid focusing the contenteditable div\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Use get_gap to check if the click was within a gap\n    const gapInfo = getGap(event);\n\n    if (gapInfo) {\n        showGapSettingsModal(gapInfo);\n    }\n};\n\n\n/**\n * Creates an editable div called tiny_select_area and replaces the TinyMCE instance\n */\nconst createGapSelectArea = () => {\n    /* global tinyMCE */\n    const editor = tinyMCE.get('id_questiontext');\n    const container = editor.getContainer();\n    const tox = container.querySelector('.tox-edit-area');\n    // Check if tiny_select_area already exists (toggle back to TinyMCE)\n    const existingSelectArea = document.getElementById('tiny_select_area');\n    if (existingSelectArea) {\n        // Toggle back: remove tiny_select_area and show TinyMCE\n        existingSelectArea.remove();\n        container.style.display = 'block';\n        return;\n    }\n    // Get the actual editor dimensions from the edit area\n    const editorElement = tox.querySelector('.tox-edit-area');\n    const editorWidth = editorElement ? editorElement.offsetWidth : container.offsetWidth;\n    const editorHeight = editorElement ? editorElement.offsetHeight : container.offsetHeight;\n    // Get the text content from TinyMCE\n    const questionText = editor.getContent();\n    // Process the text with parseQuestionText to wrap gaps in spans\n    const processedText = parseQuestionText(questionText);\n    // Create the tiny_select_area div\n    const selectArea = document.createElement('div');\n    selectArea.id = 'tiny_select_area';\n    selectArea.className = 'tiny_select_area';\n    selectArea.contentEditable = 'false';\n    selectArea.innerHTML = processedText;\n    // Apply dimensions\n    selectArea.style.width = editorWidth + 'px';\n    selectArea.style.height = editorHeight + 'px';\n    // Insert the tiny_select_area where the TinyMCE instance was\n    container.parentNode.insertBefore(selectArea, container.nextSibling);\n    container.style.display = 'none';\n\n    // Attach event handler to the select area\n    // Use capture phase to ensure we get the event before contenteditable tries to focus\n    selectArea.addEventListener('click', (event) => handleSelectAreaClick(event), true);\n\n    // Initialize gap classes for all gaps in the select area\n    // We need a small delay to ensure the DOM is fully updated\n    setTimeout(() => {\n        initializeAllGapClasses();\n    }, 100);\n};\n\n\n/**\n * Initialize the gap feedback functionality\n */\nexport const init = async() => {\n    // Wait for the button element to be ready in the DOM\n    const button = document.getElementById('id_itemsettings_button');\n    if (button) {\n        button.addEventListener('click', (event) => {\n            event.preventDefault();\n            createGapSelectArea();\n        });\n    }\n};\n"],"names":["createGapSelectArea","editor","tinyMCE","get","container","getContainer","tox","querySelector","existingSelectArea","document","getElementById","remove","style","display","editorElement","editorWidth","offsetWidth","editorHeight","offsetHeight","questionText","getContent","processedText","selectArea","createElement","id","className","contentEditable","innerHTML","width","height","parentNode","insertBefore","nextSibling","addEventListener","event","preventDefault","stopPropagation","gapInfo","handleSelectAreaClick","setTimeout","async","button"],"mappings":"mNAgCMA,oBAAsB,WAElBC,OAASC,QAAQC,IAAI,mBACrBC,UAAYH,OAAOI,eACnBC,IAAMF,UAAUG,cAAc,kBAE9BC,mBAAqBC,SAASC,eAAe,uBAC/CF,0BAEAA,mBAAmBG,cACnBP,UAAUQ,MAAMC,QAAU,eAIxBC,cAAgBR,IAAIC,cAAc,kBAClCQ,YAAcD,cAAgBA,cAAcE,YAAcZ,UAAUY,YACpEC,aAAeH,cAAgBA,cAAcI,aAAed,UAAUc,aAEtEC,aAAelB,OAAOmB,aAEtBC,eAAgB,2BAAkBF,cAElCG,WAAab,SAASc,cAAc,OAC1CD,WAAWE,GAAK,mBAChBF,WAAWG,UAAY,mBACvBH,WAAWI,gBAAkB,QAC7BJ,WAAWK,UAAYN,cAEvBC,WAAWV,MAAMgB,MAAQb,YAAc,KACvCO,WAAWV,MAAMiB,OAASZ,aAAe,KAEzCb,UAAU0B,WAAWC,aAAaT,WAAYlB,UAAU4B,aACxD5B,UAAUQ,MAAMC,QAAU,OAI1BS,WAAWW,iBAAiB,SAAUC,OArDXA,CAAAA,QAE3BA,MAAMC,iBACND,MAAME,wBAGAC,SAAU,gBAAOH,OAEnBG,yCACqBA,UA4CuBC,CAAsBJ,SAAQ,GAI9EK,YAAW,2CAER,oBAOaC,gBAEVC,OAAShC,SAASC,eAAe,0BACnC+B,QACAA,OAAOR,iBAAiB,SAAUC,QAC9BA,MAAMC,iBACNnC"}