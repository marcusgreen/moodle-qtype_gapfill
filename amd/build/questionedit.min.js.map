{"version":3,"sources":["../src/questionedit.js"],"names":["define","$","Item","init","on","attoIsLive","length","css","display","color","innerHTML","M","util","get_string","attr","get","isContentEditable","find","settingformheight","settingformwidth","copyStyles","ed","closest","appendTo","background","html","prop","height","width","wrapContent","backgroundColor","removeAttr","e","target","id","match","delimitchars","val","item","itemsettings","getItemSettings","correctfeedback","incorrectfeedback","text","title","stripdelim","require","dialog","position","my","at","of","modal","buttons","click","JSONstr","updateJson","toArray","obj","arr","i","iLen","push","el","count","gaps","parentNode","document","body","node","nodes","childNodes","frag","l","substring","r","regex","RegExp","sp","span","createElement","skip","script","button","input","select","textarea","option","nodeType","tagName","toLowerCase","textsplit","data","split","createDocumentFragment","j","jLen","doGap","replaceChild","test","cloneNode","className","gaptext","instance","k","is","striptags","appendChild","createTextNode","source","product","style","name","dom","window","getComputedStyle","uc","a","b","toUpperCase","camelize","string","replace","camel","value","getPropertyValue","currentStyle"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript code for the gapfill question type.\n *\n * @package    qtype_gapfill\n * @copyright  2017 Marcus Green\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\n/* The data is stored in a hidden field */\ndefine(['jquery', 'qtype_gapfill/Item'], function($, Item) {\n  return {\n    init: function() {\n      /* A click on the button */\n      $('#id_itemsettings_button').on('click', function() {\n        var attoIsLive = $('.editor_atto').length;\n        /* Show error if Atto is not loaded. It might be because the page has not finished loading\n         * or because plain text elements are being used or (perhaps less likely as time goes on)\n         * the HTMLarea editor is being used. It might be possible to work with those other editors\n         * but limiting to Atto keeps things straightforward and maintainable.\n         */\n        if (attoIsLive < 1) {\n          $('#id_error_itemsettings_button').css({\n            display: 'inline',\n            color: 'red',\n          });\n          $('#id_error_itemsettings_button')[0].innerHTML = M.util.get_string(\n            'itemsettingserror',\n            'qtype_gapfill'\n          );\n          return;\n        }\n        $('#questiontext .atto_html_button').attr('disabled', 'true');\n        if ($('#id_questiontexteditable').get(0).isContentEditable) {\n          $('#id_questiontexteditable').attr('contenteditable', 'false');\n          $('#fitem_id_questiontext')\n            .find('button')\n            .attr('disabled', 'true');\n          var settingformheight = $('#id_questiontexteditable').css('height');\n          var settingformwidth = $('#id_questiontexteditable').css('width');\n          $('#id_questiontexteditable').css('display', 'none');\n          /* Copy the styles from attos editable area so the canvas looks the same (except gray) */\n          $('#id_itemsettings_canvas').css(\n            copyStyles($('#id_questiontexteditable'))\n          );\n          var ed = $('#id_questiontexteditable').closest(\n            '.editor_atto_content_wrap'\n          );\n          $('#id_itemsettings_canvas')\n            .appendTo(ed)\n            .css('position', 'relative');\n          $('#id_itemsettings_canvas').css({\n            display: 'block',\n            background: 'lightgrey',\n          });\n\n          /* Copy the real html to the feedback editing html */\n          $('#id_itemsettings_canvas').html(\n            $('#id_questiontexteditable').prop('innerHTML')\n          );\n          $('#id_itemsettings_canvas').css({\n            height: settingformheight,\n            width: settingformwidth,\n          });\n          $('#id_itemsettings_canvas').css({height: '100%', width: '100%'});\n          $('#id_itemsettings_button').html(\n            M.util.get_string('editquestiontext', 'qtype_gapfill')\n          );\n          /* Setting the height by hand gets around a quirk of MSIE */\n          $('#id_itemsettings_canvas').height(\n            $('#id_questiontexteditable').height()\n          );\n          /* Disable the buttons on questiontext but not on the feedback form */\n          /* wrapContent should be the last on this block as it sometimes falls over with an error */\n          wrapContent($('#id_itemsettings_canvas')[0]);\n        } else {\n          $('#id_questiontexteditable').css({\n            display: 'block',\n            backgroundColor: 'white',\n          });\n          $('#id_questiontexteditable').attr('contenteditable', 'true');\n          $('#id_itemsettings_canvas').css('display', 'none');\n          $('#fitem_id_questiontext')\n            .find('button')\n            .removeAttr('disabled');\n          $('#id_settings_popup').css('display', 'none');\n          $('#id_itemsettings_button').html(\n            M.util.get_string('additemsettings', 'qtype_gapfill')\n          );\n          $('[class^=atto_]').removeAttr('disabled');\n        }\n      });\n\n      /* A click on the text */\n      $('#id_itemsettings_canvas').on('click', function(e) {\n        /*\n         * Questiontext needs to be edditable and the target must start\n         * with id followed by one or more digits and an underscore\n         * */\n        if (\n          !$('#id_questiontexteditable').get(0).isContentEditable &&\n          e.target.id.match(/^id[0-9]+_/)\n        ) {\n          var delimitchars = $('#id_delimitchars').val();\n          var item = new Item(e.target.innerHTML, delimitchars);\n\n          // Var item = new Item(e.target.innerHTML, delimitchars);\n          var itemsettings = item.getItemSettings(e.target);\n          if (itemsettings === null || itemsettings.length === 0) {\n            $('#id_correcteditable').html('');\n            $('#id_incorrecteditable').html('');\n          } else {\n            $('#id_correcteditable').html(itemsettings.correctfeedback);\n            $('#id_incorrecteditable').html(itemsettings.incorrectfeedback);\n          }\n          $(\"label[for*='id_correct']\").text(\n            M.util.get_string('correct', 'qtype_gapfill')\n          );\n          $(\"label[for*='id_incorrect']\").text(\n            M.util.get_string('incorrect', 'qtype_gapfill')\n          );\n          $('#id_itemsettings_popup .atto_image_button').attr(\n            'disabled',\n            'true'\n          );\n          $('#id_itemsettings_popup .atto_media_button').attr(\n            'disabled',\n            'true'\n          );\n          $('#id_itemsettings_popup .atto_managefiles_button').attr(\n            'disabled',\n            'true'\n          );\n          var title = M.util.get_string('additemsettings', 'qtype_gapfill');\n          /* The html jquery call will turn any encoded entities such as &gt; to html, i.e. > */\n          title +=\n            ': ' +\n            $('<div/>')\n              .html(item.stripdelim())\n              .text();\n          require(['jquery', 'jqueryui'], function($) {\n            $('#id_itemsettings_popup').dialog({\n              position: {\n                my: 'right',\n                at: 'right',\n                of: '#id_itemsettings_canvas',\n              },\n              height: 500,\n              width: '70%',\n              modal: false,\n              title: title,\n              buttons: [\n                {\n                  text: 'OK',\n                  click: function() {\n                    var JSONstr = item.updateJson(e);\n                    $('[class^=atto_]').removeAttr('disabled');\n                    $(\"[name='itemsettings']\").val(JSONstr);\n                    $('.ui-dialog-content').dialog('close');\n                    /* Set editable to true as it is checked at the start of click */\n                    $('#id_questiontexteditable').attr(\n                      'contenteditable',\n                      'true'\n                    );\n                    $('#id_itemsettings_button').click();\n                  },\n                },\n              ],\n            });\n          });\n        }\n      });\n\n      /**\n       * Convert an object to an array\n       * @param {object} obj\n       * @return {array}\n       */\n      function toArray(obj) {\n        var arr = [];\n        for (var i = 0, iLen = obj.length; i < iLen; i++) {\n          arr.push(obj[i]);\n        }\n        return arr;\n      }\n\n      // Wrap the words of an element and child elements in a span.\n      // Recurs over child elements, add an ID and class to the wrapping span.\n      // Does not affect elements with no content, or those to be excluded.\n      var wrapContent = (function() {\n        return function(el) {\n          var count = 0;\n          var gaps = [];\n          // If element provided, start there, otherwise use the body.\n          el = el && el.parentNode ? el : document.body;\n          // Get all child nodes as a static array.\n          var node,\n            nodes = toArray(el.childNodes);\n          if (el.id === 'id_questiontextfeedback' && count > 0) {\n            count = 0;\n          }\n          var frag, text;\n          var delimitchars = $('#id_delimitchars').val();\n          var l = delimitchars.substring(0, 1);\n          var r = delimitchars.substring(1, 2);\n          var regex = new RegExp('(\\\\' + l + '.*?\\\\' + r + ')', 'g');\n          var sp,\n            span = document.createElement('span');\n          // Tag names of elements to skip, there are more to add.\n          var skip = {\n            script: '',\n            button: '',\n            input: '',\n            select: '',\n            textarea: '',\n            option: '',\n          };\n          // For each child node...\n          for (var i = 0, iLen = nodes.length; i < iLen; i++) {\n            node = nodes[i];\n            // If it's an element, call wrapContent.\n            if (node.nodeType === 1 && !(node.tagName.toLowerCase() in skip)) {\n              wrapContent(node);\n              // If it's a text node, wrap words.\n            } else if (node.nodeType === 3) {\n              var textsplit = new RegExp('(\\\\' + l + '.*?\\\\' + r + ')', 'g');\n              text = node.data.split(textsplit);\n              if (text) {\n                // Create a fragment, handy suckers these.\n                frag = document.createDocumentFragment();\n                for (var j = 0, jLen = text.length; j < jLen; j++) {\n                  // If not whitespace, wrap it and append to the fragment.\n                  doGap(text, span, j);\n                }\n              }\n              // Replace the original node with the fragment.\n              node.parentNode.replaceChild(frag, node);\n            }\n          }\n          /**\n           * Process each gap\n           *\n           * @param {*} text\n           * @param {*} span\n           * @param {*} j\n           */\n          function doGap(text, span, j) {\n            gaps = [];\n            if (regex.test(text[j])) {\n              sp = span.cloneNode(false);\n              count++;\n              sp.className = 'item';\n              var item = new Item(text[j], $('#id_delimitchars').val());\n              if (item.gaptext > '') {\n                var instance = 0;\n                for (var k = 0; k < gaps.length; ++k) {\n                  if (gaps[k] === item.text) {\n                    instance++;\n                  }\n                }\n                item.id = 'id' + count + '_' + instance;\n                sp.id = item.id;\n                var is = item.getItemSettings(item);\n                if (item.striptags(is.correctfeedback) > '') {\n                  sp.className = 'hascorrect';\n                }\n                if (item.striptags(is.incorrectfeedback) > '') {\n                  sp.className = sp.className + ' ' + 'hasnocorrect';\n                }\n                gaps.push(item.gaptext);\n              }\n              sp.appendChild(document.createTextNode(text[j]));\n              frag.appendChild(sp);\n              // Otherwise, just append it to the fragment.\n            } else {\n              frag.appendChild(document.createTextNode(text[j]));\n            }\n          }\n        };\n      })();\n      /**\n       *\n       * @param {array} source\n       * @return {array} product\n       */\n      function copyStyles(source) {\n        // The map to return with requested styles and values as KVP.\n        var product = {};\n        // The style object from the DOM element we need to iterate through.\n        var style;\n        // Recycle the name of the style attribute.\n        var name;\n        // Prevent from empty selector.\n        if (source.length) {\n          // Otherwise, we need to get everything.\n          var dom = source.get(0);\n          if (window.getComputedStyle) {\n            // Convenience methods to turn css case ('background-image') to camel ('backgroundImage').\n            var pattern = /-([a-z])/g;\n            var uc = function(a, b) {\n              return b.toUpperCase();\n            };\n            var camelize = function(string) {\n              return string.replace(pattern, uc);\n            };\n            // Make sure we're getting a good reference.\n            if ((style = window.getComputedStyle(dom, null))) {\n              var camel, value;\n              for (var i = 0, l = style.length; i < l; i++) {\n                name = style[i];\n                camel = camelize(name);\n                value = style.getPropertyValue(name);\n                product[camel] = value;\n              }\n            } else if ((style = dom.currentStyle)) {\n              for (name in style) {\n                product[name] = style[name];\n              }\n            } else if ((style = dom.style)) {\n              for (name in style) {\n                if (typeof style[name] != 'function') {\n                  product[name] = style[name];\n                }\n              }\n            }\n            return product;\n          }\n        }\n        return false;\n      }\n    },\n  };\n});\n"],"file":"questionedit.min.js"}